\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{oakdocs}

%% Draft
\RequirePackage{blindtext}
% \RequirePackage{showframe}

%% Packages
\RequirePackage{geometry}
\RequirePackage[fulladjust]{marginnote}
\RequirePackage{calc}
\RequirePackage{xcolor}
\RequirePackage{tabularx}
\RequirePackage{graphicx}
\RequirePackage{tikz}
\RequirePackage{multicol}
\RequirePackage[verbose]{wrapfig}
\RequirePackage{anyfontsize}
\RequirePackage{xunicode}
\RequirePackage{xltxtra}
\RequirePackage{fontspec}
\RequirePackage{amsmath}
\RequirePackage{amstext}
\RequirePackage{polyglossia}
\RequirePackage{enumitem}
\RequirePackage{setspace}
\RequirePackage{titlesec}
\RequirePackage{listings}
\RequirePackage{caption}
\RequirePackage[backend=bibtex8]{biblatex}
\RequirePackage{makeidx}
\RequirePackage{fancyhdr}
% \RequirePackage{nameref}
\RequirePackage{titleref}
\RequirePackage{hyperref}

\RequirePackage[document]{ragged2e}


%% Consts
\DeclareRobustCommand{\us}{OakCoding}
\DeclareRobustCommand{\ourTeam}{The~\us~Team}
\DeclareRobustCommand{\appName}{\us}
\DeclareRobustCommand{\docsname}{คู่มือการใช้งาน \appName}
\DeclareRobustCommand{\oakrepourl}{https://github.com/CS211-651/project211-oakcoding.git}

\DeclareRobustCommand{\oakrulecolor}{\color{black}}
\definecolor{oakgrey}{RGB}{245,245,245}


%% Text
\disablehyphenation

\setdefaultlanguage{english}                    % setting default lang to thai is causing toc error
\setotherlanguage[numerals=arabic]{thai}

\addto\captionsenglish{%
\renewcommand{\contentsname}{สารบัญ}}        % setting default lang to thai is causing toc error

\addto\captionsenglish{%
    \renewcommand{\listtablename}{สารบัญตาราง}}

\addto\captionsenglish{%
    \renewcommand{\tablename}{ตารางที่}}

\addto\captionsenglish{%
    \renewcommand{\listfigurename}{สารบัญรูป}}

\addto\captionsenglish{%
    \renewcommand{\figurename}{รูปที่}}

\renewcommand{\lstlistlistingname}{สารบัญลิสต์}

\renewcommand{\lstlistingname}{ลิสต์ที่}


\XeTeXlinebreaklocale "th"

\setmainfont{SukhumvitSet}
\newfontfamily\thaifont{SukhumvitSet}[Script=Thai]


\sloppy


%% Graphical things
\geometry{%
paper=a4paper,
twoside=false,
hmargin={0.86in,0.86in},
vmargin={1in,1.3in},
marginparwidth=110pt,
marginparsep=30pt,
includemp=true,
reversemarginpar=true}


%% Page Head/Foot
\pagestyle{fancy}
\addtolength{\headsep}{24pt}
\setlength{\headheight}{14pt}
\addtolength{\headwidth}{\marginparsep + \marginparwidth}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0.4pt}

\fancyhf{}
\fancyhead[R]{\leftmark}
\fancyfoot[L]{\textbf{\docsname}}
\fancyfoot[R]{\thepage}

\renewcommand{\sectionmark}[1]{\markboth{#1}{}}
\renewcommand{\subsectionmark}[1]{\markright{#1}}

\DeclareRobustCommand{\oakheader}[3]{%
    \fancypagestyle{custom}{%
        \fancyhead[L]{#1}
        \fancyhead[C]{#2}
        \fancyhead[R]{#3}}
    \thispagestyle{custom}}


%% PDF
\hypersetup{%
pdftitle={\docsname},
pdfsubject={OakCoding},
pdfauthor={\ourTeam},
pdfkeywords={{Software Construction}, 01418211, \us, {Complaint System}}}


%% Sections and Paragraphs
\renewcommand*{\raggedleftmarginnote}{}
\renewcommand{\marginfont}{\footnotesize}

\setlength{\parindent}{0em}
\renewcommand{\baselinestretch}{1.3}

% Tables
\let\oldtabular\tabular
\let\oldendtabular\endtabular
\renewenvironment{tabular}{%
\vspace{\baselineskip}
\oldtabular}{%
\oldendtabular
\vspace{\baselineskip}}

% CSV gists
\setcounter{secnumdepth}{4}

\titleformat{\section}
{\Huge\bfseries}                % format
{\thesection}                   % label
{26pt}                          % sep: length between 'label' and 'title body'
{}
{}

\titleformat{\subsection}
{\Large\bfseries}               % format
{\thesubsection}                % label
{22pt}                          % sep: length between 'label' and 'title body'
{}
{}

\titleformat{\subsubsection}
{\large\bfseries}               % format
{\thesubsubsection}             % label
{22pt}                          % sep: length between 'label' and 'title body'
{}
{}

\titlespacing{\section}
{0pt}
{2ex}
{10ex}

\titlespacing{\subsection}
{0pt}
{6ex}
{2ex}

\titlespacing{\subsubsection}
{0pt}
{3ex}
{1.6ex}


%% Items
\setlist[description, 1]{%
align=left,
listparindent=0pt,
labelwidth=10em,
itemsep=1.5ex}

\setlist[enumerate, 1]{%
align=left,
leftmargin=*,
itemsep=1ex}

\setlist[itemize, 1]{%
align=left,
leftmargin=*,
itemsep=1ex}


%% Listings
\lstset{%
escapechar=\%,
breakatwhitespace=true,
breakautoindent=true,
breaklines=true,
basicstyle=\ttfamilylatin,
commentstyle=\color{olive},
keywordstyle=\color{magenta},
numbers=left,
captionpos=b,
belowcaptionskip=1ex,
tabsize=4,
frame=single,
% frameround=tttt,
framexleftmargin=0mm,
framexrightmargin=0mm,
rulecolor=\color{white},
% backgroundcolor=\color{oakgrey},
aboveskip=1.5ex,
belowskip=1.5ex}

% from <https://tex.stackexchange.com/questions/215697/skip-line-numbers-and-resume-from-specific-number>
\let\origthelstnumber\thelstnumber
\makeatletter

\newcommand*{\lstrestorenumbers}[1]{%
    \setcounter{lstnumber}{\numexpr#1-1\relax}
    \lst@AddToHook{OnNewLine}{%
    \let\thelstnumber\origthelstnumber%
    \refstepcounter{lstnumber}
    }%
}

\newcommand*{\lstsuppressnumbers}{%
\lst@AddToHook{OnNewLine}{%
    \let\thelstnumber\relax%
    \advance\c@lstnumber-\@ne\relax%
    }%
}
\makeatother


%% Custom Commands
\reversemarginpar
\DeclareRobustCommand{\oakmarginpar}[1]{%
\marginnote[#1]}

\DeclareRobustCommand{\oaksimsec}[1]{%
\vspace{2.4\parsep}
\textbf{#1}
\vspace{1.6\parsep}\newline}

\DeclareRobustCommand{\oaksecref}[1]{%
%% \hypersetup{hidelinks}
\textbf{\hyperref[#1]{%
% \if\getrefnumber{#1}\relax%
% \else
\ref{#1}~%
% \fi
\nameref{#1}}}}

% Images
\DeclareRobustCommand{\oakparimage}[1]{%
\includegraphics[%
width=0.8\textwidth,
height=0.8\textwidth,
keepaspectratio]{#1}}


%% Custom Environments
\newenvironment{oaknohead}{%
\oakheader{}{}{}}{}

\newenvironment{oaktable}[2][t]{%
\begin{tabular}[#1]{#2}}{%
\end{tabular}}


%% Hooks
\AtBeginDocument{%
\edef\marginnotetextwidth{\the\textwidth}}


%% Init
\def\arraystretch{1}
\setlength{\parskip}{1.3ex}

\captionsetup{%
justification=raggedright,
singlelinecheck=false}

\makeindex
